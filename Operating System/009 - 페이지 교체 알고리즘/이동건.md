# 페이지 교체

가상 메모리 기법을 요구하는 방식 중 하나인 요구 페이징 방식은 페이지 부재(page fault)가 발생하게 된다. 페이지 교체 하는 것은 오버헤드를 동반하므로 가능하면 페이지 교체가 적게 일어나야한다.

페이지 부재(page fault)가 발생하면 요청된 페이지를 디스크에서 메모리로 읽어와야 한다. 이때 물리적 메모리에 빈 프레임이 존재하지 않을 수 있다. 이 경우 **물리적 메모리에 올라와 있는 페이지 중 하나를 선택해서 디스크의 스왑 영역으로 보내야 한다.** 이를 **페이지 교체**라고 한다.

## 페이지 교체 알고리즘

> 어떠한 프레임에 있는 페이지를 디스크의 스왑 영역으로 보낼 거인지를 결정하는 알고리즘
> 

**페이지 부재율을 최소화 하기 위해!**

가까운 미래에 참조될 가능성이 가장 적은 페이지를 선택해서 내보낸다

---

### 선입 선출(FIFO)

> **가장 먼저 올라온 페이지**를 우선적으로 내보냄
> 
![Untitled](https://user-images.githubusercontent.com/70252417/209145217-c87f3cda-a3b9-478f-92fb-cbb6bd444e27.png)


가장 간단한 방법이며 특히 초기화 코드에서 적절한 방법이다.

> 초기화 코드 : 처음 프로세스 실행될 때 최초 초기화를 시키는 역할만 진행하고 다른 역할은 수행하지 않으므로, 메인 메모리에서 빼도 괜찮음
> 

페이지의 향후 참조 가능성을 고려하지 않기 때문에 비효율정적인 상황이 발생할 수 있다.

---

### LRU(Least Recently Used Algorithm)

페이지 교체 알고리즘의 성능 향상을 위해선 **앞으로 사용 가능성이 낮은 페이지를 우선적으로 내보내는 것이 좋다.** 이와 관련해서 **시간 지역성**이라는 성질이 있다. 시간 지역성은 최근에 참조된 페이지가 미래에 다시 참조될 가능성이 높은 성질을 말한다. LRU 알고리즘은 이와 같은 성질을 활용해서 페이지 교체 시 **가장 오래전에 참조가 이루어진 페이지를 내보낸다.**
![Untitled 1](https://user-images.githubusercontent.com/70252417/209145236-9bb041c1-71cd-463b-b22b-4256bcbda3c3.png)


---

### OPT

OPT알고리즘은 앞으로 가장 사용하지 않을 페이지를 가장 우선적으로 내보낸다. FIFO에 비해 페이지 부재수를 줄일 수 있다.

![Untitled 2](https://user-images.githubusercontent.com/70252417/209145263-f1fb9918-80f3-42de-8322-0f7c6f591207.png)

하지만, 실질적으로 페이지가 앞으로 잘 사용되지 않을 것이라는 보장이 없기 때문에 수행하기 어렵다.

---

### LFU(Least Frequently Used Algorithm)
![Untitled 3](https://user-images.githubusercontent.com/70252417/209145283-508f5c70-655a-41f9-addf-75cb29d43795.png)


물리적 메모리 내에 존재하는 페이지 중에서 **과거에 참조 횟수가 가장 적은 페이지를 교체 시킬 페이지로 결정하는 방식이다. LFU 알고리즘은 크게 두 가지로 나누어 진다.**

- Incache-LFU: 메모리에 적재될 때부터 페이지의 횟수를 카운트 하는 방식
- Perfect-LFU: 메모리 적재 여부와 상관 없이 페이지의 과거 총 참조 횟수를 카운트 하는 방식

---

### 클럭 알고리즘 (NRU or NUR)

클럭 알고리즘은 **하드웨어적인 자원을 통해** 기존(LRU, LFU)알고리즘의 소프트웨어적인 운영 오버헤드를 줄인 방식이다. NRU(Not Used Recently) 또는 NUR(Not Recently Used) 알고리즘이라고도 부르기도 한다.

클럭 알고리즘은 **LRU처럼 가장 최근에 참조되지 않은 페이지를 대상으로 선정한다는 점에서 LRU와 유사하지만 교체되는 페이지의 참조 시점이 가장 오래되었다는 것을 보장하지는 않는다.**


클럭 알고리즘은 그림처럼 **참조 비트(reference bit)**를 순차적으로 조사하며 동작한다.
![Untitled 4](https://user-images.githubusercontent.com/70252417/209145300-9bd01cb5-9276-4cf0-ae01-7d090be87594.png)

1. 프레임 내의 페이지가 참조될 때 하드웨어에 의해 1로 자동 세팅된다.
2. 클럭 알고리즘은 한 바퀴 돌며 참조되지 않은 페이지의 참조 비트 값을 0으로 바꾼 후 지나간다.
3. 참조 비트가 0인 페이지를 방문하면 해당 페이지를 교체한다.

즉, 페이지가 참조되어 1이 되고, 한 바퀴 도는 동안 사용되지 않으면 0이 되고 다시 한 바퀴를 도는 동안 사용되지 않는 페이지는 참조되지 않았으므로 교체 대상 페이지로 선정하는 알고리즘이다.
